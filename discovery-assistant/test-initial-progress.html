<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Initial Progress Bug</title>
</head>
<body>
    <h1>בדיקת באג התקדמות ראשונית</h1>
    <button onclick="clearLocalStorage()">נקה localStorage</button>
    <button onclick="checkInitialProgress()">בדוק התקדמות ראשונית</button>
    <button onclick="createMeeting()">צור פגישה חדשה</button>
    <button onclick="checkProgress()">בדוק התקדמות נוכחית</button>

    <div id="results"></div>

    <script>
        const API_URL = 'http://localhost:5176';

        function clearLocalStorage() {
            localStorage.clear();
            document.getElementById('results').innerHTML += '<p>✓ localStorage נוקה</p>';
        }

        function checkInitialProgress() {
            const data = localStorage.getItem('discovery-assistant-storage');
            if (!data) {
                document.getElementById('results').innerHTML += '<p>אין נתונים ב-localStorage</p>';
                return;
            }

            const store = JSON.parse(data);
            document.getElementById('results').innerHTML += '<pre>' + JSON.stringify(store.state, null, 2) + '</pre>';

            // Check if there's a current meeting
            if (store.state.currentMeeting) {
                const meeting = store.state.currentMeeting;
                console.log('Current meeting modules:', meeting.modules);

                // Check each module for initial data
                Object.entries(meeting.modules).forEach(([moduleName, moduleData]) => {
                    const isEmpty = !moduleData || Object.keys(moduleData).length === 0;
                    document.getElementById('results').innerHTML +=
                        `<p>Module ${moduleName}: ${isEmpty ? 'EMPTY ✓' : 'HAS DATA ✗'}</p>`;
                    if (!isEmpty) {
                        console.error(`Module ${moduleName} has initial data:`, moduleData);
                    }
                });
            }
        }

        function createMeeting() {
            // Simulate creating a new meeting
            const newMeeting = {
                meetingId: Math.random().toString(36).substr(2, 9),
                clientName: 'Test Client',
                date: new Date(),
                timer: 0,
                modules: {
                    overview: {},
                    leadsAndSales: {},
                    customerService: {},
                    operations: {},
                    reporting: {},
                    aiAgents: {},
                    systems: {},
                    roi: {},
                    planning: {}
                },
                painPoints: [],
                notes: ''
            };

            const existingData = localStorage.getItem('discovery-assistant-storage');
            let store = existingData ? JSON.parse(existingData) : { state: { meetings: [], currentMeeting: null }, version: 0 };

            store.state.currentMeeting = newMeeting;
            store.state.meetings.push(newMeeting);

            localStorage.setItem('discovery-assistant-storage', JSON.stringify(store));
            document.getElementById('results').innerHTML += '<p>✓ פגישה חדשה נוצרה</p>';
        }

        function checkProgress() {
            // Navigate to the app and check console
            window.open(API_URL, '_blank');
            document.getElementById('results').innerHTML += '<p>פתח את הקונסולה בחלון החדש כדי לראות את ההתקדמות</p>';
        }
    </script>
</body>
</html>