<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Generation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover {
            background: #2563eb;
        }
        button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }
        #status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            display: none;
        }
        #status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        #status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        #status.loading {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¬ ×‘×“×™×§×ª ×™×¦×™×¨×ª PDF ×¢× ×˜×§×¡×˜ ×¢×‘×¨×™</h1>
        <p>×˜×¡×˜ ×–×” ×‘×•×“×§ ×©×”×¤×•× ×§×¦×™×” generateProposalPDF ×¢×•×‘×“×ª ×›×¨××•×™ ×¢×:</p>
        <ul>
            <li>âœ… ×¤×•× ×˜ Rubik ×©×ª×•××š ×‘×¢×‘×¨×™×ª</li>
            <li>âœ… RTL (×›×ª×™×‘×” ××™××™×Ÿ ×œ×©×××œ) ×¢× setR2L(true)</li>
            <li>âœ… ×˜×¢×™× ×ª ×¤×•× ×˜ ×“×™× ××™×ª ×¢× fetch()</li>
            <li>âœ… ×™×¦×™×¨×ª PDF ××œ× ×¢× ×˜×‘×œ×”</li>
        </ul>

        <button id="testBtn" onclick="runTest()">ğŸš€ ×”×¨×¥ ×‘×“×™×§×”</button>

        <div id="status"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.4/jspdf.plugin.autotable.min.js"></script>

    <script>
        async function loadFont(path) {
            const response = await fetch(path);
            const blob = await response.blob();

            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onloadend = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.readAsDataURL(blob);
            });
        }

        async function runTest() {
            const statusEl = document.getElementById('status');
            const btnEl = document.getElementById('testBtn');

            try {
                btnEl.disabled = true;
                statusEl.className = 'loading';
                statusEl.style.display = 'block';
                statusEl.innerHTML = '<strong>â³ ×˜×•×¢×Ÿ ×¤×•× ×˜...</strong>';

                const rubikFont = await loadFont('/fonts/Rubik-VariableFont_wght.ttf');
                statusEl.innerHTML = '<strong>â³ ×™×•×¦×¨ PDF...</strong>';

                const doc = new window.jspdf.jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4',
                });

                doc.addFileToVFS('Rubik-VariableFont_wght.ttf', rubikFont);
                doc.addFont('Rubik-VariableFont_wght.ttf', 'Rubik', 'normal');
                doc.addFont('Rubik-VariableFont_wght.ttf', 'Rubik', 'bold');

                doc.setFont('Rubik');
                doc.setR2L(true);

                doc.setFontSize(28);
                doc.setFont('Rubik', 'bold');
                doc.setTextColor(37, 99, 235);
                doc.text('×”×¦×¢×ª ××—×™×¨', 105, 40, { align: 'center' });

                doc.setFontSize(14);
                doc.setFont('Rubik', 'normal');
                doc.setTextColor(0, 0, 0);
                doc.text('×©× ×œ×§×•×—: ×—×‘×¨×ª ×‘×“×™×§×” ×‘×¢"×', 190, 60, { align: 'right' });
                doc.text('×ª××¨×™×š: 07/10/2025', 190, 70, { align: 'right' });

                doc.setFontSize(12);
                const hebrewText = '×–×”×• ×˜×¡×˜ ×œ×‘×“×™×§×ª ×ª××™×›×” ×‘×¢×‘×¨×™×ª. ×”×¤×•× ×˜ Rubik ×ª×•××š ×‘×›×œ ×”×ª×•×•×™× ×”×¢×‘×¨×™×™× ×•×”-RTL ×¤×•×¢×œ ×›×¨××•×™.';
                const lines = doc.splitTextToSize(hebrewText, 160);
                doc.text(lines, 190, 90, { align: 'right' });

                doc.autoTable({
                    startY: 110,
                    head: [['#', '×©×™×¨×•×ª', '××—×™×¨']],
                    body: [
                        ['1', '××•×˜×•××¦×™×” ×©×œ ×ª×”×œ×™×›×™×', 'â‚ª15,000'],
                        ['2', '××™× ×˜×’×¨×¦×™×” ×¢× Zoho', 'â‚ª8,000'],
                        ['3', '×¤×™×ª×•×— AI Agent', 'â‚ª12,000'],
                    ],
                    styles: {
                        font: 'Rubik',
                        fontSize: 11,
                        halign: 'right',
                    },
                    headStyles: {
                        fillColor: [37, 99, 235],
                        textColor: [255, 255, 255],
                        fontStyle: 'bold',
                        halign: 'center',
                    },
                });

                doc.save('test-hebrew-pdf.pdf');

                statusEl.className = 'success';
                statusEl.innerHTML = `
                    <strong>âœ… ×”×¦×œ×—×”!</strong><br>
                    ×”×‘×“×™×§×” ×”×•×©×œ××” ×‘×”×¦×œ×—×”:<br>
                    â€¢ ×¤×•× ×˜ Rubik × ×˜×¢×Ÿ âœ“<br>
                    â€¢ RTL ××•×¤×¢×œ âœ“<br>
                    â€¢ ×˜×§×¡×˜ ×¢×‘×¨×™ ××•×¦×’ × ×›×•×Ÿ âœ“<br>
                    â€¢ ×˜×‘×œ×” ×¢× ×¢×‘×¨×™×ª ×¢×•×‘×“×ª âœ“<br>
                    â€¢ PDF ×”×•×¨×“ ×‘×”×¦×œ×—×” âœ“
                `;

            } catch (error) {
                statusEl.className = 'error';
                statusEl.innerHTML = `
                    <strong>âŒ ×©×’×™××”!</strong><br>
                    ${error.message}<br><br>
                    <pre>${error.stack}</pre>
                `;
            } finally {
                btnEl.disabled = false;
            }
        }
    </script>
</body>
</html>
